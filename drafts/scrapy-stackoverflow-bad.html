
<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="http://granitas.github.io/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="http://granitas.github.io/theme/pygments/github.min.css">
  <link rel="stylesheet" type="text/css" href="http://granitas.github.io/theme/font-awesome/css/font-awesome.min.css">


    <link href="http://granitas.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Blog of Bernardas Ališauskas Atom">


    <link rel="shortcut icon" href="http://localhost:8000/images/favicon.ico" type="image/x-icon">
    <link rel="icon" href="http://localhost:8000/images/favicon.ico" type="image/x-icon">

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />


<meta name="author" content="Bernardas Ališauskas" />
<meta name="description" content="The bad bits of my experience with stackoverflow scrapy tag" />
<meta name="keywords" content="scrapy, python, stackoverflow, bad">
<meta property="og:site_name" content="Blog of Bernardas Ališauskas"/>
<meta property="og:title" content="Stackoverflow [scrapy] Experience: The Bad"/>
<meta property="og:description" content="The bad bits of my experience with stackoverflow scrapy tag"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="http://granitas.github.io/drafts/scrapy-stackoverflow-bad.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2016-09-14 00:00:00+02:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="http://granitas.github.io/author/bernardas-alisauskas.html">
<meta property="article:section" content="code"/>
<meta property="article:tag" content="scrapy"/>
<meta property="article:tag" content="python"/>
<meta property="article:tag" content="stackoverflow"/>
<meta property="article:tag" content="bad"/>
<meta property="og:image" content="http://localhost:8000/images/core/me.jpg">

  <title>Blog of Bernardas Ališauskas &ndash; Stackoverflow [scrapy] Experience: The Bad</title>
</head>
<body>
  <aside>
    <div>
      <a href="http://granitas.github.io">
        <img src="http://localhost:8000/images/core/me.jpg" alt="Bernardas Ališauskas" title="Bernardas Ališauskas">
      </a>
      <h1><a href="http://granitas.github.io">Bernardas Ališauskas</a></h1>

<p>Python Developer</p>
      <nav>
        <ul class="list">
          <li><a href="http://granitas.github.io/pages/about.html#about">About</a></li>

        </ul>
      </nav>

      <ul class="social">
        <li><a class="sc-github" href="https://github.com/granitas" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-rss" href="" target="_blank"><i class="fa fa-rss"></i></a></li>
      </ul>
    </div>
  </aside>
  <main>
    <nav>
      <a href="http://granitas.github.io">    Home
</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>

      <a href="http://granitas.github.io/feeds/all.atom.xml">    Atom
</a>

    </nav>

<article class="single">
  <header>
    <h1 id="scrapy-stackoverflow-bad">Stackoverflow [scrapy] Experience: The Bad</h1>
    <p>
          Posted on Wed 14 September 2016 in <a href="http://granitas.github.io/category/code.html">code</a>


    </p>
  </header>
  <div>
    <p><em>"People suck at asking questions"</em></p>
<p>After spending over a month answering <a href="https://github.com/scrapy/scrapy"><code>scrapy</code></a> related questions I've decided to share my experience. I'll point out few things that I've learned from this little experiment and few other related comments. The quote above is a good generalization but there are a lot of good and interesting to add, for that see my previous post.</p>
<h1>The Bad</h1>
<p><img alt="scrapy stackoverflow generic question" src="http://granitas.github.io/images/scrapy_stackoverflow2.png" /><br />
The question quality is pretty poor, even compared to general stackoverflow quality. A lot of questions don't seem to be focused on general solutions but on individual problems which as far as I know is against the general rules of stackoverflow. However people seems to be giving it a pass since there is no other place to get answers to questions like this (shout out to #scrapy @ freenode).  </p>
<h2>Common Issues</h2>
<h3><strong>AJAX</strong></h3>
<p><img style="float: left;" src='http://granitas.github.io/images/scrapy_stackoverflow5.png' height=100>By far the most common issue is dealing with AJAX. What a scary name for something so simple."Asynchronous JavaScript and XML" which in the scope of web-crawling just means <em>make request for some data</em>, in other words it's just a javascript made request that retrieves some data. Usually this is used for product urls in pagination or images urls stored on some other server.<br />
There's a huge question that <a href="http://stackoverflow.com/questions/8550114/can-scrapy-be-used-to-scrape-dynamic-content-from-websites-that-are-using-ajax?rq=1">covers scrapy and AJAX here</a>. However I find the answers to be pretty bad and do not fully cover the issue or cover a completely different issue(see Selenium in The Ugly part).<br />
However there is a great blog post by Scrapinghub called <a href="https://blog.scrapinghub.com/2016/06/22/scrapy-tips-from-the-pros-june-2016/">Scraping Infinite Scrolling Pages</a> which is a must read if you're new to this! </p>
<h3><strong>CrawlSpider</strong></h3>
<p><a href='http://granitas.github.io/images/scrapy_stackoverflow3.gif'><img alt="Please stop using CrawlSpider" src="http://granitas.github.io/images/scrapy_stackoverflow4.png" /></a><br />
I'm now sure whom to blame here, but for some magical reason everyone decided to use <a href="http://doc.scrapy.org/en/latest/topics/spiders.html#scrapy.spiders.CrawlSpider"><code>CrawlSpider</code></a> scrapy spider instead of base <code>srapy.Spider</code>.<br />
<code>CrawlSpider</code> automates a lot of crawling logic by using <code>Rule</code> objects which have a lot of bells and whistles to configure how and what a spider should crawl. I personally dislike <code>CrawlSpider</code> but even with it's benefits it hides so much from the user that I would <strong>never recommend it to a new user</strong>. <br />
I have the <a href="http://doc.scrapy.org/en/latest/topics/spiders.html#scrapy.spiders.CrawlSpider">documentation page</a>of it bookmarked myself because of how confusing it can get.</p>
<p>Here's a little CrawlSpider versus Spider comparison and why I think CrawlSpider is confusing for beginners:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MySpider</span><span class="p">(</span><span class="n">CrawlSpider</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;myspider&#39;</span>
    <span class="n">start_urls</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;http://somesite.com&quot;</span><span class="p">)</span>
    <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">Rule</span><span class="p">(</span><span class="n">LinkExtractor</span><span class="p">(</span><span class="n">restrict_xpaths</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;//a[@href]&#39;</span><span class="p">]),</span>
             <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_item</span><span class="p">),</span>
        <span class="n">Rule</span><span class="p">(</span><span class="n">LinkExtractor</span><span class="p">(</span><span class="n">restrict_xpaths</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;//a[@id=&quot;cat&quot;]&#39;</span><span class="p">]),</span>
            <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="nf">parse_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">parse_category</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>


<p>First thing rules are confusing, here you have a list of objects that constructs another object with in it's parameters. Both of these objects can have multiple parameters which makes the whole thing super hectic and implicit.<br />
This is how using base Spider this would look:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MySpider</span><span class="p">(</span><span class="n">Spider</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;myspider&#39;</span>
    <span class="n">start_urls</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;http://somesite.com&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">LinkExtractor</span><span class="p">(</span><span class="n">restrict_xpaths</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;//a[@href]&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">extract_links</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="n">categories</span> <span class="o">=</span> <span class="n">LinkExtractor</span><span class="p">(</span><span class="n">restrict_xpaths</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;//a[@id=&quot;cat&quot;]&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">extract_links</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">Request</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_item</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">categories</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">Request</span><span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parse_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>


<p>As you can see this code is completely explicit, you could really get rid of <a href="http://doc.scrapy.org/en/latest/topics/link-extractors.html#module-scrapy.linkextractors.lxmlhtml"><code>LinkExtractors</code></a> just by using <code>response.xpath("//a[@href]").extract()</code> instead. The advantages of using <code>LinkExtractors</code> though, is that it filters outs non website files (i.e. pdf, mp3) as well as converting urls to absolute ones.
To understand this all you need is basic scrapy knowledge and the whole chain is predictable, clear and easily accessible for modification.</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="http://granitas.github.io/tag/scrapy.html">scrapy</a>
      <a href="http://granitas.github.io/tag/python.html">python</a>
      <a href="http://granitas.github.io/tag/stackoverflow.html">stackoverflow</a>
      <a href="http://granitas.github.io/tag/bad.html">bad</a>
    </p>
  </div>



<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'granitosaurus';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
        Please enable JavaScript to view comments.

</noscript>
</article>

    <footer>
<p>
  &copy; Bernardas Ališauskas 2016 - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
         src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>





<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Blog of Bernardas Ališauskas ",
  "url" : "http://granitas.github.io",
  "image": "http://localhost:8000/images/core/me.jpg",
  "description": "Thoughts and Writings of Granitosaurus"
}
</script>
</body>
</html>